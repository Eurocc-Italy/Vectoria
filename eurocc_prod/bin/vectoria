#!/leonardo_work/PhDLR_prod/eucc-env/bin/python3
"#!/usr/bin/python3 --> this explodes!"

"VECTORIA: Una terra fantastica dove le informazioni sono organizzate in vettori."

import os, sys
venv_path=os.environ["VIRTUAL_ENV"]
python_version=sys.version[0:4]
lib_path=venv_path + "/lib/python" + python_version + "/site-packages"

# strip it from sys.path
sys.path.remove(lib_path)

# restore it in the right position
sys.path.insert(1,lib_path)

import sys
import logging
import argparse
from argparse import Namespace

from vectoria_lib.common.paths import ETC_DIR
from vectoria_lib.tasks.db_creation import create_and_write_index
from vectoria_lib.tasks.qa_task import create_qa_agent
from vectoria_lib.io.commandline import create_cl_parser_from_json, cl_convert_to_dict

"""
logger_name = 'basic'
logger = logging.getLogger(logger_name)
logger.setLevel( "INFO" )
ch = logging.StreamHandler()
logger.addHandler(ch)
"""

def cli():
    parser = argparse.ArgumentParser(description="Main script entry point with multiple behaviors.")

    parser.add_argument(
        '--config',
        type=str,
        required=False,
        default=ETC_DIR/"vectoria_config/default_config.yaml",
        help='Path to the configuration file'
    )
    subparsers = parser.add_subparsers(
        required=True,
        dest='command',
        help='Choose a command (create_index or ask_question)'
    )
    
    parser_create_index_task = subparsers.add_parser('create_index', formatter_class=argparse.RawTextHelpFormatter, help='Run the create_index behavior')
    create_cl_parser_from_json(parser_create_index_task, 'db_creation.json')

    parser_ask_question_task = subparsers.add_parser('ask_question', formatter_class=argparse.RawTextHelpFormatter, help='Run the ask_question behavior')
    create_cl_parser_from_json(parser_ask_question_task, 'qa_task.json')

    return parser.parse_args()

def main():
    args = cli()
    if args.command == 'create_index':
        create_and_write_index(args)
    elif args.command == 'ask_question':
        create_qa_agent(args)

if __name__ == "__main__":
    main()
